function get_name(url){if(url.includes("cnn")){return CNN;}else if(url.includes("fox")){return FOX;}else if(url.includes("nytimes")){return NYT;}else if(url.includes("wsj")){return WSJ;}else if(url.includes("washington")){return WAPO;}else{alert("something awry, none of the 5 news sites included. url ="+url);return false;}}function set_correct_page(url,pdf){var name=get_name(url);if(name==CNN){cnnp=pdf;}else if(name==FOX){foxp=pdf;}else if(name==NYT){nytp=pdf;}else if(name==WSJ){wsjp=pdf;}else if(name==WAPO){wapop=pdf;}else{alert("again shouldn't be here.\n");}}function get_pdf(name){if(name==CNN){return cnnp;}else if(name==FOX){return foxp;}else if(name==NYT){return nytp;}else if(name==WSJ){return wsjp;}else if(name==WAPO){return wapop;}else{alert('wtf');return null;}}function loadPdf(url,cvname,dname,cv2,d2,a,a2){console.log('load pdf '+url+' '+cvname+' '+dname+' '+d2+' '+a+' '+a2);var name=get_name(url);var gpdf=get_pdf(name);if(gpdf!=null){given_pdf(pdf,url,cvname,dname,cv2,d2,a,a2);}else{PDFJS.getDocument(url).then(pdf=>{pdfDocument=pdf;set_correct_page(url,pdf);given_pdf(pdf,url,cvname,dname,cv2,d2,a,a2);});}};function given_pdf(pdf,url,cvname,dname,cv2,d2,a,a2){pdf.getPage(1).then(function(page){console.log('here');console.log(pdf+' '+url+' '+cvname+' '+dname+' '+cv2+' '+d2+' '+a+' '+a2);console.log('Page loaded');var scale=1;var viewport=page.getViewport(scale);var canvas=document.getElementById(cvname);var context=canvas.getContext('2d');canvas.width=viewport.width;canvas.height=viewport.height;canvas.style.width="100%";canvas.style.height="100%";var pdfContainer=document.getElementById(dname);var ldiv=document.getElementById('div-left');console.log('ldiv '+ldiv.offsetWidth+'viewport w'+viewport.width);var sc=ldiv.clientWidth*.8/viewport.width;console.log('scale '+sc+' means width is '+viewport.width*sc);pdfContainer.style.width=Math.floor(viewport.width*sc)+'pt';pdfContainer.style.height=Math.floor(viewport.height*sc)+'pt';var annote=document.getElementById(a);annote.style.width=Math.floor(viewport.width*sc)+'pt';annote.style.height=Math.floor(viewport.height*sc)+'pt';var canvas2=document.getElementById(cv2);var context2=canvas2.getContext('2d');canvas2.width=viewport.width;canvas2.height=viewport.height;canvas2.style.width="100%";canvas2.style.height="100%";var wrapper2=document.getElementById(d2);var ldiv=document.getElementById('div-left');console.log('ldiv '+ldiv.offsetWidth+'viewport w'+viewport.width);console.log('scale '+sc+' means width is '+viewport.width*sc);wrapper2.style.width=Math.floor(viewport.width*sc)+'pt';wrapper2.style.height=Math.floor(viewport.height*sc)+'pt';var annote2=document.getElementById(a2);annote2.style.width=Math.floor(viewport.width*sc)+'pt';annote2.style.height=Math.floor(viewport.height*sc)+'pt';setupAnnotations(page,viewport,cvname,annote,1.33*sc);setupAnnotations(page,viewport,cv2,annote2,1.33*sc);var renderContext={canvasContext:context,viewport:viewport,};page.render(renderContext);});}function setupAnnotations(page,viewport,canvas,$annotationLayerDiv,scale){var promise=page.getAnnotations().then(function(annotationsData){viewport=viewport.clone({dontFlip:true});for(var i=0;i<annotationsData.length;i++){var data=annotationsData[i];var annotation=PDFJS.Annotation.fromData(data);if(!annotation||!annotation.hasHtml()){continue;}var element=annotation.getHtmlElement(page.commonObjs);data=annotation.getData();var rect=data.rect;var view=page.view;rect=PDFJS.Util.normalizeRect([rect[0],view[3]-rect[1]+view[1],rect[2],view[3]-rect[3]+view[1]]);var dv=document.getElementById(canvas);var dp=dv.parentNode;var dpp=dp.parentNode;element.style.left=(dpp.offsetLeft+rect[0]*scale)+'px';element.style.top=(dpp.offsetTop+rect[1]*scale)+'px';element.style.width=Math.ceil(scale*(rect[2]-rect[0]))+'px'
element.style.height=Math.ceil(scale*(rect[3]-rect[1]))+'px'
element.style.position='absolute';var transform=viewport.transform;var transformStr='matrix('+transform.join(',')+')';CustomStyle.setProp('transform',element,transformStr);var transformOriginStr=-rect[0]+'px '+-rect[1]+'px';CustomStyle.setProp('transformOrigin',element,transformOriginStr);if(data.subtype==='Link'&&!data.url){continue;}$annotationLayerDiv.append(element);}});return promise;};